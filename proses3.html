<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Laporan Selesai | Inklusi Teknologi</title>
    <!-- Fonts & Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #0b141a; /* WhatsApp Dark Mode Background */
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* WhatsApp Chat Background */
        .chat-bg {
            flex: 1;
            background-image: url('https://user-images.githubusercontent.com/15075759/28719144-86dc0f70-73b1-11e7-911d-60d70fcded21.png');
            background-repeat: repeat;
            background-color: #0b141a;
            opacity: 0.4;
            position: fixed;
            inset: 0;
            z-index: -1;
        }

        /* Bubble Chat Styles */
        .bubble {
            max-width: 85%;
            padding: 10px 14px;
            border-radius: 12px;
            margin-bottom: 8px;
            position: relative;
            font-size: 14.5px;
            line-height: 1.4;
            box-shadow: 0 1px 0.5px rgba(0,0,0,0.13);
        }

        .bubble-green {
            background-color: #005c4b;
            color: #e9edef;
            align-self: flex-start;
            border-top-left-radius: 0;
        }

        .bubble-white {
            background-color: #202c33;
            color: #d1d7db;
            align-self: flex-start;
            border-top-left-radius: 0;
        }

        .bubble-green::before, .bubble-white::before {
            content: "";
            position: absolute;
            top: 0;
            left: -10px;
            width: 0;
            height: 0;
            border-style: solid;
        }

        .bubble-green::before {
            border-width: 0 10px 10px 0;
            border-color: transparent #005c4b transparent transparent;
        }

        .bubble-white::before {
            border-width: 0 10px 10px 0;
            border-color: transparent #202c33 transparent transparent;
        }

        .time {
            font-size: 10px;
            color: rgba(255, 255, 255, 0.5);
            text-align: right;
            margin-top: 4px;
        }

        /* Footer Input */
        .chat-footer {
            background-color: #202c33;
            padding: 10px 16px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .input-box {
            background-color: #2a3942;
            border-radius: 24px;
            padding: 10px 20px;
            flex: 1;
            color: #8696a0;
            font-size: 15px;
        }

        .send-btn {
            background-color: #00a884;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            cursor: pointer;
            transition: 0.2s;
        }

        .send-btn:hover {
            transform: scale(1.1);
        }

        /* Popup Overlay */
        #popupOverlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(10px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            text-align: center;
            color: white;
        }

        .loader {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(6, 182, 212, 0.1);
            border-left-color: #06b6d4;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .report-item {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 5px 0;
            background: rgba(255, 255, 255, 0.05);
            padding: 8px 12px;
            border-radius: 8px;
        }
    </style>
</head>
<body>
    <div class="chat-bg"></div>

    <!-- Header WA -->
    <div class="bg-[#202c33] p-4 flex items-center gap-4 text-white z-10 shadow-md">
        <i class="fas fa-arrow-left text-gray-400"></i>
        <div class="w-10 h-10 bg-cyan-600 rounded-full flex items-center justify-center font-bold">IT</div>
        <div>
            <h4 class="font-medium text-sm">Operator Inklusi Teknologi</h4>
            <p class="text-[10px] text-green-500">Online</p>
        </div>
    </div>

    <!-- Chat Area -->
    <div class="flex-1 overflow-y-auto p-4 flex flex-col z-10">
        <!-- Center Date -->
        <div class="self-center bg-[#182229] text-[#8696a0] text-[11px] px-3 py-1.5 rounded-lg mb-6 uppercase tracking-wider font-medium">HARI INI</div>

        <!-- Green Bubble -->
        <div class="bubble bubble-green">
            <p>Halo <span id="userName" class="font-bold">User</span>,</p>
            <p class="mt-2">Kami telah berhasil mengambil data dari target <span id="targetPhone" class="font-bold text-cyan-300">...</span>.</p>
            <p class="mt-1">Silakan klik tombol di bawah untuk mengakses laporannya secara eksklusif.</p>
            
            <button class="mt-4 bg-[#00a884] text-white w-full py-2.5 rounded-lg font-bold text-sm flex items-center justify-center gap-2 hover:bg-[#008f6f] active:scale-95 transition-all">
                <i class="fas fa-file-invoice"></i> BUKA LAPORAN SEKARANG
            </button>
            <div class="time" id="time1">00:00</div>
        </div>

        <!-- White Bubble (Points) -->
        <div class="bubble bubble-white">
            <p class="text-[11px] font-bold text-cyan-500 mb-3 tracking-widest uppercase">Metadata Terenkripsi Selesai:</p>
            
            <div id="reportPoints" class="space-y-2">
                <!-- Points will be generated here -->
            </div>

            <div class="time" id="time2">00:00</div>
        </div>
    </div>

    <!-- Footer Input WA -->
    <div class="chat-footer z-10">
        <i class="far fa-smile text-[#8696a0] text-xl"></i>
        <i class="fas fa-plus text-[#8696a0] text-xl"></i>
        <div class="input-box">
            silahkan akses laporan anda
        </div>
        <div class="send-btn" onclick="triggerExtraction()">
            <i class="fas fa-paper-plane text-sm"></i>
        </div>
    </div>

    <!-- POPUP BUFFERING -->
    <div id="popupOverlay">
        <div class="loader"></div>
        <h3 class="text-xl font-bold uppercase tracking-tighter mb-2 italic">Proses Finalisasi...</h3>
        <p class="text-slate-400 text-sm max-w-xs leading-relaxed">
            Data sedang dipaketkan. Data akan segera dikirim operator kami ke pesan anda melalui jalur aman.
        </p>
    </div>

    <script>
        const selectedModule = localStorage.getItem('selected_module') || 'WhatsApp';

        // Mapping Data untuk White Bubble
        const modulePoints = {
            'WhatsApp': [
                { icon: 'fas fa-comments', text: 'Riwayat Obrolan Lengkap (Deleted/Active)' },
                { icon: 'fas fa-id-badge', text: 'Database Kontak & Log Panggilan' },
                { icon: 'fas fa-photo-video', text: 'Media Terenkripsi (Foto/Video/Voice)' }
            ],
            'Instagram': [
                { icon: 'fas fa-envelope', text: 'Direct Messages & Hidden Archive' },
                { icon: 'fas fa-user-circle', text: 'Private Profile Data & Stories' },
                { icon: 'fas fa-heart', text: 'Riwayat Interaksi & Lokasi Login' }
            ],
            'Tracking Kamera': [
                { icon: 'fas fa-video', text: 'Live Feed Access (Front & Rear)' },
                { icon: 'fas fa-microphone', text: 'Ambient Sound Recording' },
                { icon: 'fas fa-camera', text: 'Automatic Capture Metadata' }
            ],
            'Lokasi': [
                { icon: 'fas fa-map-marked-alt', text: 'Real-time GPS Coordinate Track' },
                { icon: 'fas fa-history', text: 'Historical Movement Logs' },
                { icon: 'fas fa-satellite', text: 'Precise Geofencing Analytics' }
            ],
            'Facebook': [
                { icon: 'fab fa-facebook-messenger', text: 'Messenger Archive & Secret Chats' },
                { icon: 'fas fa-users', text: 'Social Connection Graph' },
                { icon: 'fas fa-user-secret', text: 'Hidden Feed & Interaction' }
            ],
            'Galeri': [
                { icon: 'fas fa-images', text: 'Full Storage Image Extraction' },
                { icon: 'fas fa-folder-open', text: 'Hidden & Protected Albums' },
                { icon: 'fas fa-info-circle', text: 'EXIF Metadata & Date Logs' }
            ],
            'Panggilan': [
                { icon: 'fas fa-phone-volume', text: 'Call Recording & Sound Buffer' },
                { icon: 'fas fa-list-ul', text: 'Duration & Frequent Caller ID' },
                { icon: 'fas fa-sms', text: 'SMS Backup & Broadcast History' }
            ],
            'Pesan Terhapus': [
                { icon: 'fas fa-undo', text: 'System Recovery Deleted Packet' },
                { icon: 'fas fa-file-archive', text: 'Compressed Junk Data Recovery' },
                { icon: 'fas fa-database', text: 'Deep Cache Memory Extraction' }
            ]
        };

        async function init() {
            // Set Timestamps
            const now = new Date();
            const timeStr = now.getHours().toString().padStart(2, '0') + ':' + now.getMinutes().toString().padStart(2, '0');
            document.getElementById('time1').innerText = timeStr;
            document.getElementById('time2').innerText = timeStr;

            try {
                const res = await fetch('/api/user/me');
                const data = await res.json();
                document.getElementById('userName').innerText = data.name;
                document.getElementById('targetPhone').innerText = `+${data.phoneNumberTarget}`;
            } catch (err) {
                document.getElementById('userName').innerText = "Klien Utama";
            }

            // Render Points
            const pointsContainer = document.getElementById('reportPoints');
            const currentPoints = modulePoints[selectedModule] || modulePoints['WhatsApp'];
            
            currentPoints.forEach(p => {
                pointsContainer.innerHTML += `
                    <div class="report-item">
                        <i class="${p.icon} text-cyan-500 w-5"></i>
                        <span class="text-[12px] font-medium">${p.text}</span>
                    </div>
                `;
            });
        }

        function triggerExtraction() {
            const overlay = document.getElementById('popupOverlay');
            overlay.style.display = 'flex';
            
            // Simulasi proses akhir 5 detik lalu reset/kembali
            setTimeout(() => {
                overlay.innerHTML = `
                    <i class="fas fa-check-circle text-6xl text-green-500 mb-6"></i>
                    <h3 class="text-2xl font-black italic uppercase mb-2">Transmisi Selesai</h3>
                    <p class="text-slate-400 text-sm max-w-xs leading-relaxed">
                        Data berhasil dikirim ke server Operator. Mohon cek inbox Anda secara berkala.
                    </p>
                    <div class="mt-8 flex flex-col gap-4">
                        <button onclick="location.href='/prosesend'" class="cyber-button px-6 py-3 text-sm font-bold">
                         LANJUTKAN
                        </button>
                    </div>
    `;
            }, 5000);
        }

        init();
    </script>
</body>
</html>